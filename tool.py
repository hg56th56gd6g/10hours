#-*- coding:utf-8 -*-
class Frame:
    #这个帧宽多少字符,高多少字符,对应的文件名
    def __init__(self,Width,Height,Name):
        #以及总共多少字符
        self.CharWidth=Width
        self.CharHeight=Height
        self.CharLength=Width*Height
        #代表这个类型的帧的宽高各多少像素,以及总共多少像素
        Width=(CharWidth*Width)+(BlankWidth*(Width-1))
        self.PixelWidth=Width
        Height=(CharHeight*Height)+(BlankHeight*(Height-1))
        self.PixelHeight=Height
        self.PixelLength=Width*Height
        #帧的像素信息(nv12格式,纯黑底),以及帧占用多少字节长度
        self.Frame=bytearray((b"\x00"*self.PixelLength)+(b"\x80"*(self.PixelLength//2)))
        self.FrameLength=self.PixelLength*3//2
        #打开文件(缓冲区大小根据帧大小上取整到64kb)
        self.File=open(Name,"wb",((self.FrameLength+65535)//65536)*65536)
        #ffmpeg参数
        self.ffmpeg=f"-f rawvideo -pixel_format nv12 -color_range pc -video_size {Width}x{Height} -i {Name}"
    #写入当前帧到文件
    def Write(self):
        self.File.write(self.Frame)
    #刷新到磁盘
    def Flush(self):
        self.File.flush()
    #关闭文件
    def Close(self):
        self.File.close()
    #更改指定坐标的字符
    def SetChar(self,x,y,c):
        #将像素信息中的数据逐行复制过来
        #先计算出初始要跳过的字节数,然后每行完成后跳过数加一行
        j=(y*(CharHeight+BlankHeight)*self.PixelWidth)+(x*(CharWidth+BlankWidth))
        c=Data[c]
        for a in range(CharHeight):
            self.Frame[j:j+CharWidth:]=c[a]
            j+=self.PixelWidth
#使用unifont,这里定义了每个字符的宽与高,字符间水平空白的宽,和字符间垂直空白的高
CharWidth=6
CharHeight=10
BlankWidth=2
BlankHeight=2
#储存了"0123456789"的像素信息(y通道,\x00是黑,\xff是白)
Data={
0:(
    b"\x00\x00\xff\xff\x00\x00",
    b"\x00\xff\x00\x00\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\xff\xff",
    b"\xff\x00\x00\xff\x00\xff",
    b"\xff\x00\xff\x00\x00\xff",
    b"\xff\xff\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\x00\x00\xff\x00",
    b"\x00\x00\xff\xff\x00\x00",
),
1:(
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\xff\xff\x00\x00",
    b"\x00\xff\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\xff\xff\xff\xff\xff",
),
2:(
    b"\x00\xff\xff\xff\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\xff\xff\x00",
    b"\x00\x00\xff\x00\x00\x00",
    b"\x00\xff\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\xff\xff\xff\xff\xff",
),
3:(
    b"\x00\xff\xff\xff\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\xff\xff\xff\x00",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\x00",
),
4:(
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\xff\xff\x00",
    b"\x00\x00\xff\x00\xff\x00",
    b"\x00\xff\x00\x00\xff\x00",
    b"\xff\x00\x00\x00\xff\x00",
    b"\xff\x00\x00\x00\xff\x00",
    b"\xff\xff\xff\xff\xff\xff",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\x00\xff\x00",
),
5:(
    b"\xff\xff\xff\xff\xff\xff",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\xff\xff\xff\xff\x00",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\x00",
),
6:(
    b"\x00\x00\xff\xff\xff\x00",
    b"\x00\xff\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\x00\x00\x00\x00\x00",
    b"\xff\xff\xff\xff\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\x00",
),
7:(
    b"\xff\xff\xff\xff\xff\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
    b"\x00\x00\x00\xff\x00\x00",
),
8:(
    b"\x00\xff\xff\xff\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\x00",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\x00",
),
9:(
    b"\x00\xff\xff\xff\xff\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\xff\x00\x00\x00\x00\xff",
    b"\x00\xff\xff\xff\xff\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\x00\xff",
    b"\x00\x00\x00\x00\xff\x00",
    b"\x00\xff\xff\xff\x00\x00",
)
}